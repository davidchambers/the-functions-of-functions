<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <title>The Functions of Functions</title>

  <!-- Required stylesheet -->
  <link rel="stylesheet" href="lib/deck.js/core/deck.core.css">

  <!-- Extension CSS files go here. Remove or add as needed. -->
  <link rel="stylesheet" href="lib/deck.js/extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" href="lib/deck.js/extensions/status/deck.status.css">
  <link rel="stylesheet" href="lib/deck.js/extensions/hash/deck.hash.css">
  <link rel="stylesheet" href="lib/deck.js/extensions/scale/deck.scale.css">

  <link rel="stylesheet" href="style.css">

  <!-- Transition theme. More available in /themes/transition/ or create your own. -->
  <link rel="stylesheet" href="lib/deck.js/themes/transition/horizontal-slide.css">

  <!-- Required Modernizr file -->
  <script src="lib/deck.js/modernizr.custom.js"></script>

  <script src="//use.typekit.net/qda7hnw.js"></script>
  <script>try{Typekit.load()}catch(e){}</script>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->

<section class="slide">
  <h1>The Functions<br>of Functions</h1>
</section>

<section class="slide">
  <p>Before we can understand functions, let’s talk about values</p>
</section>

<section class="slide">
  <p>Values can be atomic, such as the number forty-two</p>
</section>

<section class="slide">
  <p>Or composite, such as the set of even integers</p>
</section>

<section class="slide">
  <p>It’s important to realize that values, by definition, do not change</p>
</section>

<section class="slide">
  <p>Adding 42 and 5 does not change the value of either number</p>
</section>

<section class="slide">
  <p>Likewise, adding the sets <span class="nowrap">{1, 2, 3}</span> and <span class="nowrap">{2, 4, 6}</span> has no effect on either value</p>
</section>

<section class="slide">
  <p>So what are functions?</p>
</section>

<section class="slide">
  <p>Two types: “pure” and “impure”
</section>

<section class="slide">
  <p>Pure functions describe relationships between values</p>
</section>

<section class="slide">
  <p>Sine, cosine, and tangent describe the relationships between angles and sides of right-angled triangles</p>
</section>

<section class="slide">
  <p>The most important quality of pure functions is referential transparency</p>
</section>

<section class="slide">
  <blockquote cite="http://en.wikipedia.org/wiki/Referential_transparency_(computer_science)">
    <p>An expression is said to be referentially transparent if it can be replaced with its value without changing the [program’s] behavior</p>
    <footer>Wikipedia</footer>
  </blockquote>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">var</span> x = 1;
<span class="keyword">var</span> y = 2;
<span class="keyword">var</span> z = x + y;
<span class="comment">//      ^^^^^</span>
<span class="comment">//      referentially transparent expression</span>

<span class="keyword">var</span> a = [x, y, z];
<span class="keyword">var</span> b = a.pop();
<span class="comment">//      ^^^^^^^</span>
<span class="comment">//      referentially opaque expression</span>
</code></pre>
</section>

<section class="slide">
  <p>Referentially transparent functions are easier to reason about, as one needn’t mentally construct a program’s state</p>
</section>

<section class="slide">
  <p>Referentially transparent functions are deterministic</p>
</section>

<section class="slide">
  <p>Deterministic functions are easy to test</p>
</section>

<section class="slide">
  <p>Deterministic functions can be memoized</p>
  <pre><code class="clojure"><span class="comment">; (g x) equivalent to (f x)</span>
<span class="comment">; caching saves computation</span>
(def g (memoize f))
</code></pre>
</section>

<section class="slide">
  <p>Deterministic expressions can be replaced by their values at <em>any</em> time, even compile time</p>
  <pre><code class="clojure">(every? odd? [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]) <span class="comment">; can be replaced by false</span>
</code></pre>
</section>

<section class="slide">
  <p>Deterministic expressions can be executed in parallel</p>
  <pre><code class="haskell">qs :: Ord a =&gt; [a] -&gt; [a]
qs []     = []
qs (p:xs) = (qs lesser) ++ [p] ++ (qs greater)
    <span class="keyword">where</span>
        lesser  = filter (&lt; p) xs
        greater = filter (&gt;= p) xs
</code></pre>
</section>

<section class="slide">
  <p>Pure functions make functional programming possible; higher-order functions make it thrilling</p>
</section>

<section class="slide">
  <p>Higher-order functions take and/or return functions</p>
</section>

<section class="slide">
  <p>Higher-order functions have many uses…</p>
</section>

<section class="slide">
  <p>Mapping</p>
  <pre><code class="clojure"><span class="prompt">&gt;</span> (map count [<span class="string">"abc"</span> {:x <span class="number">0</span>} [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span>]])
(<span class="number">3</span> <span class="number">1</span> <span class="number">4</span>)
</code></pre>
</section>

<section class="slide">
  <p>Filtering</p>
  <pre><code class="clojure"><span class="prompt">&gt;</span> (filter even? [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>])
(<span class="number">2</span> <span class="number">4</span>)</code></pre>
</section>

<section class="slide">
  <p>Reducing</p>
  <pre><code class="clojure"><span class="prompt">&gt;</span> (reduce * [<span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span>])
<span class="number">120</span>
</code></pre>
</section>

<section class="slide">
  <p>“Splatting” a list into positional args</p>
  <pre><code class="clojure"><span class="prompt">&gt;</span> <span class="comment">; nums is [4 -2 7 1]</span>
<span class="prompt">&gt;</span> (apply max nums) <span class="comment">; (max 4 -2 7 1)</span>
<span class="number">7</span>
</code></pre>
</section>

<section class="slide">
  <p>Composing functions</p>
  <pre><code class="clojure">(def odd? (complement even?))
</code></pre>
</section>

<section class="slide">
  <p>Partial application</p>
  <pre><code class="clojure">(def zero? (partial = <span class="number">0</span>))
</code></pre>
  <!--
  <pre><code class="python"><span class="prompt">&gt;&gt;&gt;</span> <span class="keyword">from</span> functools <span class="keyword">import</span> partial
<span class="prompt">&gt;&gt;&gt;</span> basetwo = partial(<span class="ctor">int</span>, base=<span class="number">2</span>)
<span class="prompt">&gt;&gt;&gt;</span> basetwo.__doc__ = <span class="string">"Convert base 2 string to an int."</span>
<span class="prompt">&gt;&gt;&gt;</span> basetwo(<span class="string">"10010"</span>) <span class="comment"># int("10010", base=2)</span>
<span class="number">18</span>
</code></pre>
  -->
</section>

<section class="slide">
  <p>Higher-order functions<br>lead to declarative code</p>
</section>

<section class="slide">
  <h1>What <em>is</em> declarative code?</h1>
</section>

<section class="slide">
  <p>A declarative expression describes <em>what</em> it does rather than <em>how</em> it does it</p>
</section>

<section class="slide">
  <p>SQL is a declarative</p>
  <pre><code class="sql"><span class="keyword">SELECT</span> *
 <span class="keyword">FROM</span> Book
 <span class="keyword">WHERE</span> price &gt; <span class="number">100.00</span>
 <span class="keyword">ORDER BY</span> title;
</code></pre>
</section>

<section class="slide">
  <p>Most code is imperative</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="comment">// triple each num in nums</span>
<span class="keyword">function</span> tripleAll(nums) {
  <span class="keyword">var</span> res = [];
  <span class="keyword">var</span> idx = <span class="number">0</span>;
  <span class="keyword">while</span> (idx &lt; nums.length) {
    res.push(<span class="number">3</span> * nums[idx++]);
  }
  <span class="keyword">return</span> res;
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript highlighted"><span class="highlight comment">// enumeration</span>
<span class="keyword">function</span> tripleAll(nums) {
  <span class="keyword">var</span> res = [];
  <span class="highlight"><span class="keyword">var</span> idx = <span class="number">0</span>;</span>
  <span class="highlight"><span class="keyword">while</span> (idx &lt; nums.length) {</span>
    res.push(<span class="number">3</span> * <span class="highlight">nums[idx++]</span>);
  <span class="highlight">}</span>
  <span class="keyword">return</span> res;
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript highlighted"><span class="highlight comment">// accumulation</span>
<span class="keyword">function</span> tripleAll(nums) {
  <span class="highlight"><span class="keyword">var</span> res = [];</span>
  <span class="keyword">var</span> idx = <span class="number">0</span>;
  <span class="keyword">while</span> (idx &lt; nums.length) {
    <span class="highlight">res.push(</span><span class="number">3</span> * nums[idx++]<span class="highlight">);</span>
  }
  <span class="highlight"><span class="keyword">return</span> res;</span>
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript highlighted"><span class="highlight comment">// transformation</span>
<span class="keyword">function</span> tripleAll(nums) {
  <span class="keyword">var</span> res = [];
  <span class="keyword">var</span> idx = <span class="number">0</span>;
  <span class="keyword">while</span> (idx &lt; nums.length) {
    res.push(<span class="highlight"><span class="number">3</span> *</span> nums[idx++]);
  }
  <span class="keyword">return</span> res;
}
</code></pre>
</section>

<section class="slide">
  <p>In declarative terms…</p>
</section>

<section class="slide">
  <pre><code class="clojure"><span class="comment">; triple each num in nums</span>
(map (partial * <span class="number">3</span>) nums)
</code></pre>
</section>

<section class="slide">
  <h1>Lisp</h1>
</section>

<section class="slide">
  <blockquote cite="http://bc.tech.coop/blog/060224.html">
    <p>Lisp is the most important<br>idea in computer science</p>
    <footer>Alan Kay</footer>
  </blockquote>
</section>

<section class="slide">
  <p>The word “Lisp” is derived from <span style="white-space:nowrap">“LISt Processing”</span></p>
</section>

<section class="slide">
  <p>Lists are at the heart of Lisp</p>
</section>

<section class="slide">
  <p>Even Lisp programs are lists!</p>
</section>

<!-- TODO: mention that Lisps have very little syntax -->

<section class="slide">
  <p>But lists are widely used in most languages, so why is Lisp special?</p>
</section>

<section class="slide">
  <p>This is probably what you imagine when you hear the word “list”</p>
  <pre style="font-size:150%"><code class="javascript">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]
</code></pre>
</section>

<section class="slide">
  <p>But not all lists can be represented in this manner</p>
</section>

<section class="slide">
  <p>How can one represent the sequence of natural numbers, say, in a program?</p>
</section>

<section class="slide">
  <p>Three operations must be supported…</p>
</section>

<section class="slide">
  <p>Getting the <code>first</code> element</p>
</section>

<section class="slide">
  <p>Getting the <code>rest</code> of the elements</p>
</section>

<section class="slide">
  <p>Prepending an element (<code>cons</code>)</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> <span class="ctor">LazySeq</span>(f) {
  <span class="keyword">this</span>.f = f;
  <span class="keyword">this</span>.state = {};
  <span class="keyword">this</span>.state.all   = <span class="keyword">this</span>.state;
  <span class="keyword">this</span>.state.first = <span class="keyword">this</span>.state;
  <span class="keyword">this</span>.state.rest  = <span class="keyword">this</span>.state;
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="ctor">LazySeq</span>.prototype.first = <span class="keyword">function</span>() {
  <span class="keyword">if</span> (<span class="keyword">this</span>.state.all === <span class="keyword">this</span>.state) {
    <span class="keyword">this</span>.state.all = <span class="keyword">this</span>.f();
  }
  <span class="keyword">if</span> (<span class="keyword">this</span>.state.first === <span class="keyword">this</span>.state) {
    <span class="keyword">this</span>.state.first = first(<span class="keyword">this</span>.state.all);
  }
  <span class="keyword">return</span> <span class="keyword">this</span>.state.first;
};
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="ctor">LazySeq</span>.prototype.rest = <span class="keyword">function</span>() {
  <span class="keyword">if</span> (<span class="keyword">this</span>.state.all === <span class="keyword">this</span>.state) {
    <span class="keyword">this</span>.state.all = <span class="keyword">this</span>.f();
  }
  <span class="keyword">if</span> (<span class="keyword">this</span>.state.rest === <span class="keyword">this</span>.state) {
    <span class="keyword">this</span>.state.rest = rest(<span class="keyword">this</span>.state.all);
  }
  <span class="keyword">return</span> <span class="keyword">this</span>.state.rest;
};
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> first(iter) {
  <span class="keyword">return</span> iter <span class="keyword">instanceof</span> <span class="ctor">LazySeq</span> ?
         iter.first() : iter[<span class="number">0</span>];
}

<span class="keyword">function</span> rest(iter) {
  <span class="keyword">return</span> iter <span class="keyword">instanceof</span> <span class="ctor">LazySeq</span> ?
         iter.rest() : [].slice.call(iter, <span class="number">1</span>);
}
</code></pre>
</section>

<section class="slide">
  <p>Now we have something interesting…</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> seq = <span class="keyword">new</span> <span class="ctor">LazySeq</span>()
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> seq.state.first = <span class="number">1</span>
<span class="number">1</span>
<span class="prompt">&gt;</span> seq.state.rest = seq
{ iter: <span class="literal undefined">undefined</span>,
  state: { first: <span class="number">1</span>, rest: [Circular] } }
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> first(seq)
<span class="number">1</span>
<span class="prompt">&gt;</span> first(rest(seq))
<span class="number">1</span>
<span class="prompt">&gt;</span> first(rest(rest(seq)))
<span class="number">1</span>
<span class="prompt">&gt;</span> first(rest(rest(rest(seq))))
<span class="number">1</span>
<span class="prompt">&gt;</span> first(rest(rest(rest(rest(seq)))))
<span class="number">1</span>
</code></pre>
</section>

<section class="slide">
  <p>An infinite sequences of ones!</p>
</section>

<section class="slide">
  <p>To create more interesting sequences, we need one more function</p>
</section>

<section class="slide">
  <p><code>cons</code> is the secret sauce,<br>and it’s deceptively simple</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> cons(x, seq) {
  <span class="keyword">var</span> ls = <span class="keyword">new</span> <span class="ctor">LazySeq</span>();
  ls.state.all   = <span class="literal">null</span>;
  ls.state.first = x;
  ls.state.rest  = seq;
  <span class="keyword">return</span> ls;
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> seq = cons(<span class="number">1</span>, cons(<span class="number">2</span>, cons(<span class="number">3</span>, [])))
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> first(seq)
<span class="number">1</span>
<span class="prompt">&gt;</span> first(rest(seq))
<span class="number">2</span>
<span class="prompt">&gt;</span> first(rest(rest(seq)))
<span class="number">3</span>
</code></pre>
</section>

<section class="slide">
  <p>We can now define a recursive function which returns an infinite sequence of integers</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> range(start) {
  <span class="keyword">return</span> cons(start, <span class="keyword">new</span> <span class="ctor">LazySeq</span>(function() {
    <span class="keyword">return</span> range(start + <span class="number">1</span>);
  }));
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> seq = range(<span class="number">42</span>)
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> first(seq)
<span class="number">42</span>
<span class="prompt">&gt;</span> first(rest(seq))
<span class="number">43</span>
<span class="prompt">&gt;</span> first(rest(rest(seq)))
<span class="number">44</span>
</code></pre>
</section>

<section class="slide">
  <p>Can higher-order functions be applied to lazy sequences?</p>
</section>

<section class="slide">
  <h1>Yes!</h1>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> map(f, seq) {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="ctor">LazySeq</span>(<span class="keyword">function</span>() {
    <span class="keyword">return</span> cons(f(first(seq)),
                map(f, rest(seq)));
  });
}
</code></pre>
</section>

<section class="slide">
  <p>Let’s test it…</p>
</section>

<section class="slide">
  <p>First, let’s define <code>product</code></p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> product() {
  <span class="keyword">return</span> arguments.length == <span class="number">0</span> ? <span class="number">1</span> :
    first(arguments) * apply(product, rest(arguments));
}

<span class="keyword">function</span> apply(f, args) {
  <span class="keyword">return</span> f.apply(<span class="literal">null</span>, args);
}
</code></pre>
</section>

<section class="slide">
  <p>… and <code>partial</code></p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> partial(f) {
  <span class="keyword">var</span> args = [].slice.call(arguments, <span class="number">1</span>);
  <span class="keyword">return</span> <span class="keyword">function</span>() {
    <span class="keyword">return</span> apply(f,
      args.concat([].slice.call(arguments)));
  };
}
</code></pre>
</section>

<section class="slide">
  <p>Now we can confirm that <code>map</code> works as expected</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> seq = map(partial(product, <span class="number">3</span>), range(<span class="number">0</span>))
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> first(seq)
<span class="number">0</span>
<span class="prompt">&gt;</span> first(rest(seq))
<span class="number">3</span>
<span class="prompt">&gt;</span> first(rest(rest(seq)))
<span class="number">6</span>
<span class="prompt">&gt;</span> first(rest(rest(rest(seq))))
<span class="number">9</span>
</code></pre>
</section>

<section class="slide">
  <p>Next up: <code>filter</code></p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> filter(pred, seq) {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="ctor">LazySeq</span>(<span class="keyword">function</span>() {
    <span class="keyword">return</span> pred(first(seq)) ?
      cons(first(seq), filter(pred, rest(seq))) :
      filter(pred, rest(seq));
  });
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">function</span> isEven(n) { <span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">0</span> }
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> <span class="keyword">var</span> seq = filter(isEven, range(<span class="number">0</span>))
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> first(seq)
<span class="number">0</span>
<span class="prompt">&gt;</span> first(rest(seq))
<span class="number">2</span>
<span class="prompt">&gt;</span> first(rest(rest(seq)))
<span class="number">4</span>
</code></pre>
</section>

<section class="slide">
  <p>Now we can define other functions in terms of <code>map</code> and <code>filter</code></p>
</section>

<section class="slide">
  <p><code>distinct</code>, for example</p>
</section>

<section class="slide">
  <p>We’ll need to maintain a set of the values we encounter as we traverse the sequence</p>
</section>

<section class="slide">
  <h1>Actually, we don’t!</h1>
  <p>This was my Lisp epiphany</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> equal(a, b) {
  <span class="keyword">return</span> a === b;
}

<span class="keyword">function</span> remove(pred, seq) {
  <span class="keyword">return</span> filter(complement(pred), seq);
}

<span class="keyword">function</span> complement(f) {
  <span class="keyword">return</span> <span class="keyword">function</span>() {
    <span class="keyword">return</span> !apply(f, arguments);
  };
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> distinct(seq) {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="ctor">LazySeq</span>(<span class="keyword">function</span>() {
    <span class="keyword">var</span> f = first(seq), r = rest(seq);
    <span class="keyword">return</span> cons(f, distinct(remove(partial(equal, f), r)));
  });
}
</code></pre>
</section>

<section class="slide">
  <h1>Metaprogramming</h1>
</section>

<section class="slide">
  <blockquote cite="http://en.wikipedia.org/wiki/Metaprogramming">
    <p>Metaprogramming is the writing<br>
       of computer programs that write<br>
       or manipulate other programs<br>
       (or themselves) as their data</p>
    <footer>Wikipedia</footer>
  </blockquote>
</section>

<section class="slide">
  <p>Let’s revisit <code>range</code>…</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> range(start) {
  <span class="keyword">return</span> cons(start, <span class="keyword">new</span> <span class="ctor">LazySeq</span>(function() {
    <span class="keyword">return</span> range(start + <span class="number">1</span>);
  }));
}
</code></pre>
</section>

<section class="slide">
  <p><code>range</code> actually has four modes:</p>
  <ol>
    <li><code>range()</code></li>
    <li><code>range(end)</code></li>
    <li><code>range(start, end)</code></li>
    <li><code>range(start, end, step)</code></li>
  </ol>
</section>

<section class="slide">
  <p>The typical solution is to juggle arguments in the function body</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> range() {
  <span class="keyword">var</span> start = <span class="number">0</span>, end = <span class="number">Infinity</span>, step = <span class="number">1</span>;
  <span class="keyword">switch</span> (arguments.length) {
    <span class="keyword">case</span> <span class="number">1</span>: end   = arguments[<span class="number">0</span>]; <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="number">2</span>: start = arguments[<span class="number">0</span>];
            end   = arguments[<span class="number">1</span>]; <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="number">3</span>: start = arguments[<span class="number">0</span>];
            end   = arguments[<span class="number">1</span>];
            step  = arguments[<span class="number">2</span>];
  }
  <span class="comment">// ...</span>
}
</code></pre>
</section>

<section class="slide">
  <p>The problem with this approach is that we’ll end up writing this code for each multi-arity function</p>
</section>

<section class="slide">
  <p>Instead, let’s define a higher-order function which takes a list of functions as input and returns a function which, when called, applies the appropriate function to its arguments and returns the result</p>
</section>

<section class="slide">
  <p>First, let’s consider how we’ll use it…</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">var</span> range = def([
  <span class="keyword">function</span>() { ... },
  <span class="keyword">function</span>(end) { ... },
  <span class="keyword">function</span>(start, end) { ... },
  <span class="keyword">function</span>(start, end, step) { ... }
]);
</code></pre>
</section>

<section class="slide">
  <p>Now, the implementation…</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">function</span> def(fs) {
  <span class="keyword">return</span> <span class="keyword">function</span>() {
    <span class="keyword">for</span> (<span class="keyword">var</span> idx = <span class="number">0</span>; idx &lt; fs.length; idx++) {
      <span class="keyword">if</span> (fs[idx].length == arguments.length) {
        <span class="keyword">return</span> apply(fs[idx], arguments);
      }
    }
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="ctor">Error</span>(<span class="string">"Wrong number of args"</span>);
  };
}
</code></pre>
</section>

<section class="slide">
  <p>Now, the default values can be set very naturally</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">var</span> range = def([
  <span class="keyword">function</span>() {           <span class="keyword">return</span> range(<span class="number">Infinity</span>);      },
  <span class="keyword">function</span>(end) {        <span class="keyword">return</span> range(<span class="number">0</span>, end);        },
  <span class="keyword">function</span>(start, end) { <span class="keyword">return</span> range(start, end, <span class="number">1</span>); },
  <span class="keyword">function</span>(start, end, step) {
    <span class="comment">// ...</span>
  }
]);
</code></pre>
</section>

<section class="slide">
  <p>Now, let’s use <code>def</code> to define <code>product</code> without a conditional…</p>
</section>

<section class="slide">
  <p>First, let’s update <code>def</code> to handle variadic functions…</p>
</section>

<section class="slide">
<pre><code class="javascript"><span class="keyword">function</span> def(name, fs) {
  <span class="keyword">return</span> <span class="keyword">function</span>() {
    <span class="keyword">var</span> idx = fs.length;
    <span class="keyword">while</span> (idx--) {
      <span class="keyword">var</span> arity = fs[idx].length;
      <span class="keyword">if</span> (arity &lt;= arguments.length) {
        <span class="keyword">return</span> apply(fs[idx], arguments);
      }
    }
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="ctor">Error</span>(name + <span class="string">" takes at least "</span> + arity + <span class="string">" args"</span> +
                    <span class="string">" ("</span> + arguments.length + <span class="string">" given)"</span>);
  };
}
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="keyword">var</span> product = def(<span class="string">"product"</span>, [
  <span class="keyword">function</span>() { <span class="keyword">return</span> <span class="number">1</span>; },
  <span class="keyword">function</span>(n) {
    <span class="keyword">return</span> n * apply(product, rest(arguments));
  }
]);
</code></pre>
</section>

<section class="slide">
  <h1>Lisp is wondrous</h1>
</section>

<section class="slide">
  <h1>JavaScript is ubiquitous</h1>
</section>

<section class="slide">
  <h1>Introducing…</h1>
</section>

<section class="slide">
  <h1><img alt="Rich" src="http://cl.ly/image/182r0E39390J/logo@2x.png"></h1>
</section>

<section class="slide">
  <h1>JavaScript’s bad parts</h1>
</section>

<section class="slide">
  <h1>Confused type system</h1>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">typeof</span> <span class="string">"abc"</span>
<span class="string">"string"</span>
<span class="prompt">&gt;</span> <span class="keyword">typeof</span> <span class="keyword">new</span> <span class="ctor">String</span>(<span class="string">"abc"</span>)
<span class="string">"object"</span>
<span class="prompt">&gt;</span> <span class="keyword">typeof</span> <span class="literal undefined">undefined</span>
<span class="string">"undefined"</span>
<span class="prompt">&gt;</span> <span class="keyword">typeof</span> <span class="literal">null</span>
<span class="string">"object"</span>
<span class="prompt">&gt;</span> <span class="keyword">typeof</span> []
<span class="string">"object"</span>
</code></pre>
</section>

<section class="slide">
  <p><del><code><span class="keyword">typeof</span></code></del><br>
     <ins><code><span class="keyword">instanceof</span></code></ins></p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">new</span> <span class="ctor">String</span>(<span class="string">"abc"</span>) <span class="keyword">instanceof</span> <span class="ctor">String</span>
<span class="literal">true</span>
<span class="prompt">&gt;</span> <span class="string">"abc"</span> <span class="keyword">instanceof</span> <span class="ctor">String</span>
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <p><del><code><span class="keyword">typeof</span></code></del><br>
     <del><code><span class="keyword">instanceof</span></code></del><br>
     <ins><code>???</code></ins></p>
</section>

<section class="slide">
  <p>It turns out there is one reliable approach…</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="ctor">Object</span>.prototype.toString.call([])
<span class="string">"[object Array]"</span>
<span class="prompt">&gt;</span> <span class="ctor">Object</span>.prototype.toString.call(<span class="literal">null</span>)
<span class="string">"[object Null]"</span>
</code></pre>
</section>

<section class="slide">
  <p>… but it only works for built-in types</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">function</span> <span class="ctor">Foo</span>() {}
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> <span class="keyword">var</span> foo = <span class="keyword">new</span> <span class="ctor">Foo</span>()
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> <span class="ctor">Object</span>.prototype.toString.call(foo)
<span class="string">"[object Object]"</span>
</code></pre>
</section>

<section class="slide">
  <p><del><code><span class="keyword">typeof</span></code></del><br>
     <del><code><span class="keyword">instanceof</span></code></del><br>
     <del><code><span class="ctor">Object</span>.prototype.toString.call</code></del>
     <ins><code>???</code></ins></p>
</section>

<section class="slide">
  <h1><code style="font-family:monospace">instance?</code></h1>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">String</span>, <span class="string">"abc"</span>)
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">String</span>, <span class="keyword">new</span> <span class="ctor">String</span>(<span class="string">"abc"</span>))
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">Array</span>, [])
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <p>Works for user-defined types</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">Foo</span>, foo)
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <p>Handles inheritance</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="ctor">TypeError</span>()
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">TypeError</span>, err)
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">Error</span>, err)
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"instance?"</span>, <span class="ctor">Object</span>, err)
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <p>Lends itself to partial application</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> isArray = $$(<span class="string">"partial"</span>, <span class="string">"instance?"</span>, <span class="ctor">Array</span>)
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> isArray([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])
<span class="literal">true</span>
<span class="prompt">&gt;</span> isArray(<span class="string">"abc"</span>)
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <h1>No sets or maps*</h1>
  <aside>* coming in ES6</aside>
</section>

<section class="slide">
  <p>We make do with objects</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> var set = {}
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> set[<span class="string">"foo"</span>] = <span class="number">1</span>
<span class="number">1</span>
<span class="prompt">&gt;</span> <span class="string">"foo"</span> <span class="keyword">in</span> set
<span class="literal">true</span>
<span class="prompt">&gt;</span> <span class="string">"bar"</span> <span class="keyword">in</span> set
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <p>But they have baggage</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="string">"constructor"</span> <span class="keyword">in</span> set
<span class="literal">true</span>
<span class="prompt">&gt;</span> <span class="string">"toString"</span> <span class="keyword">in</span> set
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <p>Again, there’s a workaround</p>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="ctor">Object</span>.prototype.hasOwnProperty.call(set, <span class="string">"constructor"</span>)
<span class="literal">false</span>
<span class="prompt">&gt;</span> <span class="ctor">Object</span>.prototype.hasOwnProperty.call(set, <span class="string">"foo"</span>)
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <p>But we can still only have sets of strings</p>
</section>

<section class="slide">
  <h1><code style="font-family:monospace">set</code></h1>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="keyword">var</span> set = $$(<span class="string">"set"</span>, <span class="number">42</span>, <span class="string">"foo"</span>)
<span class="literal undefined">undefined</span>
<span class="prompt">&gt;</span> $$(<span class="string">"contains?"</span>, set, <span class="number">42</span>)
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"contains?"</span>, set, <span class="string">"42"</span>)
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <h1>No notion of value</h1>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <h1>Broken equality operators*</h1>
  <aside>* despite having both <code>==</code> and <code>===</code></aside>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> [<span class="number">42</span>] == [<span class="number">42</span>]
<span class="literal">false</span>
<span class="prompt">&gt;</span> [<span class="number">42</span>] == <span class="number">42</span>
<span class="literal">true</span>
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="number">0</span> == <span class="number">-0</span>
<span class="literal">true</span>
<span class="prompt">&gt;</span> <span class="number">0</span> === <span class="number">-0</span>
<span class="literal">true</span>
<span class="prompt">&gt;</span> <span class="number">1</span> / <span class="number">0</span> == <span class="number">1</span> / <span class="number">-0</span>
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <pre><code class="javascript"><span class="prompt">&gt;</span> <span class="literal">NaN</span> == <span class="literal">NaN</span>
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <h1><code style="font-family:monospace">=</code></h1>
</section>

<section class="slide">
  <pre><code class="javascript">
<span class="prompt">&gt;</span> $$(<span class="string">"="</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])
<span class="literal">true</span>
<span class="prompt">&gt;</span> $$(<span class="string">"="</span>, [<span class="number">42</span>], <span class="number">42</span>)
<span class="literal">false</span>
<span class="prompt">&gt;</span> $$(<span class="string">"="</span>, <span class="number">0</span>, <span class="number">-0</span>)
<span class="literal">false</span>
</code></pre>
</section>

<section class="slide">
  <h1>Thanks</h1>
</section>

<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#9664;</a>
<a href="#" class="deck-next-link" title="Next">&#9654;</a>

<!-- deck.status snippet -->
<p class="deck-status">
  <span class="deck-status-current">1</span> / <span class="deck-status-total">1</span>
</p>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="lib/deck.js/jquery-1.7.2.min.js"></script>
<script src="lib/deck.js/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="lib/deck.js/core/deck.core.js"></script>
<script src="lib/deck.js/extensions/hash/deck.hash.js"></script>
<script src="lib/deck.js/extensions/status/deck.status.js"></script>
<script src="lib/deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="lib/deck.js/extensions/scale/deck.scale.js"></script>

<script>$.deck('.slide')</script>
</body>
</html>
